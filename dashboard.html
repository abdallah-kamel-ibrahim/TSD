<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard - TSD</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{display:flex;height:100vh;background:#f4f4f4;}
.sidebar{width:220px;background:#c62828;color:#fff;padding:20px;display:flex;flex-direction:column;}
.sidebar h2{margin-bottom:40px;font-size:24px;}
.sidebar button{padding:10px;margin-top:10px;border:none;background:#b71c1c;color:#fff;border-radius:5px;cursor:pointer;}
.main{flex:1;padding:30px;overflow-y:auto;}
.main h2{margin-bottom:15px;color:#c62828;}
input,textarea,button{width:100%;padding:10px;margin:5px 0;}
button.add-btn{background:#c62828;color:white;border:none;cursor:pointer;margin-bottom:20px;}
.product-card{border:1px solid #ccc;padding:15px;margin-bottom:15px;border-radius:8px;display:flex;align-items:center;gap:15px;background:#fff;transition:transform 0.2s;}
.product-card:hover{transform:translateY(-5px);}
.product-card img{width:80px;height:80px;object-fit:cover;border-radius:5px;}
.product-info{flex:1;}
.product-info h3{color:#c62828;margin-bottom:5px;}
.product-info p{margin-bottom:5px;}
.product-card button{background:#b71c1c;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;}
</style>
</head>
<body>

<div class="sidebar">
  <h2>TSD Admin</h2>
  <button onclick="logout()">Logout</button>
</div>

<div class="main">
  <h2>Add Product</h2>
  <input id="name" placeholder="Product Name">
  <input id="price" placeholder="Price">
  <textarea id="desc" placeholder="Description"></textarea>
  <input id="imgFile" type="file">
  <button class="add-btn" onclick="addProduct()">Add Product</button>

  <h2>All Products</h2>
  <div id="productList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBZcTVzgVnM2Q9C0DelAKmqcUjsPq8zh58",
  authDomain: "totalsolutiondiagnostic-ffe97.firebaseapp.com",
  projectId: "totalsolutiondiagnostic-ffe97",
  storageBucket: "totalsolutiondiagnostic-ffe97.firebasestorage.app",
  messagingSenderId: "850936511386",
  appId: "1:850936511386:web:11f3ac64e16d8ec49c9823"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const storage = getStorage(app);

// تأكد إن الأدمن مسجل دخول
onAuthStateChanged(auth, user => {
  if(!user){
    window.location = "../admin.html"; // يرجع لصفحة login لو مش logged in
  }
});

// Logout function
window.logout = function(){
  signOut(auth).then(()=>{
    window.location="../admin.html";
  });
}

// Add product
async function addProduct() {
  const name = document.getElementById("name").value;
  const price = document.getElementById("price").value;
  const desc = document.getElementById("desc").value;
  const file = document.getElementById("imgFile").files[0];
  if(!name || !price || !file) return alert("Name, Price & Image required");

  const fileName = file.name.split("\\").pop(); // فقط اسم الملف
  const storageRef = ref(storage, `Database/${fileName}`);
  await uploadBytes(storageRef, file);
  const imgURL = await getDownloadURL(storageRef);

  await addDoc(collection(db, "Database"), {
    name,
    price,
    description: desc,
    image: imgURL
  });

  alert("Product added successfully!");
  loadProducts();
}


// Load products list
async function loadProducts(){
  const list = document.getElementById("productList");
  list.innerHTML = "";
  const snapshot = await getDocs(collection(db,"Database"));
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const id = docSnap.id;
    list.innerHTML += `
      <div class="product-card">
        <img src="${data.image}" alt="${data.name}">
        <div class="product-info">
          <h3>${data.name}</h3>
          <p>Price: ${data.price}</p>
          <p>${data.description}</p>
        </div>
        <button onclick="deleteProduct('${id}')">Delete</button>
      </div>
    `;
  });
}

// Delete product
window.deleteProduct = async function(id){
  await deleteDoc(doc(db,"Database",id));
  loadProducts();
}

// Load products on page load
loadProducts();
</script>

</body>
</html>
